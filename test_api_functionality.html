<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Functionality</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #0d1b2a;
            color: white;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #00c2ce;
            border-radius: 10px;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .success {
            border-left: 4px solid #00c2ce;
        }
        
        .error {
            border-left: 4px solid #ff6b6b;
        }
        
        .warning {
            border-left: 4px solid #ffa500;
        }
        
        button {
            background: #00c2ce;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #00a8b3;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #00c2ce;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.loading {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }
        
        .status.success {
            background: rgba(0, 194, 206, 0.2);
            color: #00c2ce;
        }
        
        .status.error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }
    </style>
</head>

<body>
    <h1>Test API Functionality</h1>

    <div class="test-section">
        <h3>‚úÖ API Files Status</h3>
        <div class="test-result success">
            <strong>‚úÖ API Directory:</strong> Created at Appweb/User/api/
        </div>
        <div class="test-result success">
            <strong>‚úÖ API File:</strong> forgot_password_updated.php created
        </div>
        <div class="test-result success">
            <strong>‚úÖ Dependencies:</strong> PHPMailer, Database config, Email config - All present
        </div>
        <div class="test-result warning">
            <strong>‚ö†Ô∏è Database Tables:</strong> Need to verify otp_codes and password_reset_tokens tables exist
        </div>
    </div>

    <div class="test-section">
        <h3>üß™ Test API Endpoints</h3>

        <div class="test-result">
            <h4>Test Request Reset Code</h4>
            <input type="email" id="testEmail" placeholder="Enter email address" value="test@example.com">
            <button onclick="testRequestReset()">Test Request Reset</button>
            <div id="requestResult" class="status"></div>
        </div>

        <div class="test-result">
            <h4>Test Resend Code</h4>
            <input type="email" id="resendEmail" placeholder="Enter email address" value="test@example.com">
            <button onclick="testResendCode()">Test Resend Code</button>
            <div id="resendResult" class="status"></div>
        </div>

        <div class="test-result">
            <h4>Test Verify Code</h4>
            <input type="email" id="verifyEmail" placeholder="Enter email address" value="test@example.com">
            <input type="text" id="verifyCode" placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}">
            <button onclick="testVerifyCode()">Test Verify Code</button>
            <div id="verifyResult" class="status"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>üìã API Endpoints Available</h3>
        <ul>
            <li><strong>request-reset:</strong> Send initial password reset code</li>
            <li><strong>resend-code:</strong> Resend verification code (with cooldown)</li>
            <li><strong>verify-code:</strong> Verify the 6-digit code</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>üîß Features Implemented</h3>
        <ul>
            <li>‚úÖ <strong>Rate Limiting:</strong> 2-minute cooldown between requests</li>
            <li>‚úÖ <strong>Code Expiration:</strong> 30-minute validity period</li>
            <li>‚úÖ <strong>Email Templates:</strong> Professional HTML emails</li>
            <li>‚úÖ <strong>Error Handling:</strong> Comprehensive error messages</li>
            <li>‚úÖ <strong>Session Management:</strong> Email storage and validation</li>
            <li>‚úÖ <strong>Security:</strong> Code verification and token generation</li>
            <li>‚úÖ <strong>Database Integration:</strong> OTP codes and reset tokens</li>
        </ul>
    </div>

    <script>
        async function testAPI(action, data) {
            const statusDiv = document.getElementById(action + 'Result');
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'Testing...';

            try {
                const formData = new FormData();
                formData.append('action', action);
                Object.keys(data).forEach(key => {
                    formData.append(key, data[key]);
                });

                const response = await fetch('Appweb/User/api/forgot_password_updated.php', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Success: ' + (result.message || 'Operation completed');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Error: ' + (result.error || 'Unknown error');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Network Error: ' + error.message;
            }
        }

        function testRequestReset() {
            const email = document.getElementById('testEmail').value;
            if (!email) {
                alert('Please enter an email address');
                return;
            }
            testAPI('request-reset', {
                email
            });
        }

        function testResendCode() {
            const email = document.getElementById('resendEmail').value;
            if (!email) {
                alert('Please enter an email address');
                return;
            }
            testAPI('resend-code', {
                email
            });
        }

        function testVerifyCode() {
            const email = document.getElementById('verifyEmail').value;
            const code = document.getElementById('verifyCode').value;
            if (!email || !code) {
                alert('Please enter both email and code');
                return;
            }
            testAPI('verify-code', {
                email,
                code
            });
        }

        // Auto-format code input
        document.getElementById('verifyCode').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').slice(0, 6);
        });
    </script>
</body>

</html>